<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="LearnOpenGL" /><meta property="og:locale" content="en_US" /><meta name="description" content="LearnOpenGL" /><meta property="og:description" content="LearnOpenGL" /><link rel="canonical" href="https://hifuyun.com/haifuyun.github.io/posts/LearnOpenGL/" /><meta property="og:url" content="https://hifuyun.com/haifuyun.github.io/posts/LearnOpenGL/" /><meta property="og:site_name" content="Hi!FuYun" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-01-08T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="LearnOpenGL" /><meta name="twitter:site" content="@haifuyun" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"LearnOpenGL","dateModified":"2018-01-08T00:00:00+08:00","datePublished":"2018-01-08T00:00:00+08:00","url":"https://hifuyun.com/haifuyun.github.io/posts/LearnOpenGL/","description":"LearnOpenGL","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hifuyun.com/haifuyun.github.io/posts/LearnOpenGL/"},"@context":"https://schema.org"}</script><title>LearnOpenGL | Hi!FuYun</title><link rel="apple-touch-icon" sizes="180x180" href="/haifuyun.github.io/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/haifuyun.github.io/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/haifuyun.github.io/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/haifuyun.github.io/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/haifuyun.github.io/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hi!FuYun"><meta name="application-name" content="Hi!FuYun"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/haifuyun.github.io/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/haifuyun.github.io/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/haifuyun.github.io/assets/js/dist/post.min.js"></script> <script defer src="/haifuyun.github.io/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/haifuyun.github.io/" alt="avatar" class="mx-auto"> <img src="https://pbs.twimg.com/profile_images/661212370547552257/xbqo4JqZ_400x400.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/haifuyun.github.io/">Hi!FuYun</a></div><div class="site-subtitle font-italic">Non-class'dev</div></div><ul class="w-100"><li class="nav-item"> <a href="/haifuyun.github.io/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/haifuyun.github.io/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/haifuyun.github.io/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/haifuyun.github.io/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/haifuyun.github.io/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/haifuyun" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/haifuyun" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/haifuyun.github.io/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/haifuyun.github.io/"> Posts </a> </span> <span>LearnOpenGL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>LearnOpenGL</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> haifuyun </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 8, 2018, 12:00 AM +0800" prep="on" > Jan 8, 2018 <i class="unloaded">2018-01-08T00:00:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4647 words">25 min</span></div></div><div class="post-content"><h2 id="learnopengl">LearnOpenGL</h2><p>OpenGL</p><p>图形渲染接口 (Linux,Windows,MacOS,iOS,Android跨平台图形接口，底层库实现由显卡厂商(AMD NVIDIA)或系统厂商(APPLE)实现)</p><p>渲染模式: Immediate mode OR Core-profile</p><p>Immediate mode(已废弃):</p><p>流水线固定渲染模式，这个模式下，所有步骤固定，只能控制整个过程中的一些阶段中一些功能的开启或者关闭</p><p>Core-profile:</p><p>核心模式，这个模式下，所有流程中的几个阶段不仅可以开启或者关闭，还可以自定义设置数据，比Immediate mode的编程自由性更强</p><p>OpenGL 整个渲染过程是一个流水的加工处理改变状态的一个过程，整体为一个状态机。</p><p>一瓶纯净水流水生产流程，从入口经过过滤、消毒、蒸馏、罐装、封瓶、封箱等一系步骤下来的一个过程。</p><p>图形渲染也类似，经过定义数据、生成图形、渲染颜色、输出至屏幕这么个大概过程，当然整个过程很复杂，前面几个简述步骤下还要细分，并且涉及到很多知识点尤其数学知识(线性代数,三角学)</p><p>OpenGL仅是一个图形渲染接口，很多其他功能并不提供，我们需要一些其他库来帮我们来完成环境开发的搭建</p><p>1.GLFW 窗口，输入处理</p><p>是一款开源、跨平台的图形窗口管理库，不仅可以用来管理窗口，还支持读取输入，处理事件等。</p><p>2.GLAD 提供OpenGL各平台底层库实现的函数调用位置查找功能</p><p>前面提到OpenGL是一个接口，每个平台有不同的实现库，那么在运行编译并不知道这些库的函数地址，那么GLAD库就是用来查找各平台库对应函数接口的位置，来让上层调用。</p><p>3.GLM 数学库</p><p>编写图形渲染代码中需要大量的使用到矩阵变换，向量变换以及各种针对矩阵和向量的计算。这一整套功能都由 GLM 库为我们提供</p><p>4.stb_image.h 文件图像加载库</p><p>能够加载大部分流行的文件格式，并且能够很简单得整合到你的工程之中，仅仅需要把这个头文件添加到你的项目中即可. 当我们需要给物体添加纹理、贴图（即现实中各种区分物品的表面可视的表面特征，金属、木头、墙、水、毛发、皮肤等）时，可用这个库来加载文件</p><p>GLSL: OpenGL Shading Language</p><p>用于编写OpenGL Shadingd代码的OpenGL专属编程语言</p><p>OpeGL渲染流程:</p><p>Vertex Data -&gt; Vertex Shader -&gt; Shape Assembly -&gt; Geometry Shader -&gt; Rasterization -&gt; Fragment Shader -&gt; Tests And Blending</p><p>顶点数据 -&gt; 顶点着色器 -&gt; 形状装配 -&gt; 几何着色器 -&gt; 光栅化 -&gt; 片段着色器 -&gt; 测试与混合</p><p>顶点数据</p><p>通常以数组方式传递一组数据（组成物体的每个顶点的3D向量数据</p><p>{x,y,z, x1,y1,z2, …}）</p><p>想象在纸上画几个点，然后用数字表示这些点距这张纸左下角的(水平方向)(垂直方向)多远</p><p>顶点着色器</p><p>对输入的3D坐标进行处理，如不同的坐标系统的坐标变换</p><p>想象你在一张A4纸上画了几个点后，想临摹到一张A2纸上，你可以把A4纸铺在A2纸上，两张纸可以左上角对左上角，右下角对右下角，右上角对右上角，左下角对左下角，或者中心对中心这几种方式。</p><p>把A4纸上的点画到A2纸上，此时这些点在A2纸上的点距离A2纸左下角的距离与A4纸这些点距离左下角的距离可能是不一样，因为两张纸大小不一样，A4纸放置在A2纸上的位置也有几种方式，因此最后描绘在A2纸上的点也有几种不同位置的结果。</p><p>另一个例子，一个人在新疆的乌鲁木齐，在不同的空间中确定他的位置:</p><p>基于中国: 在中国土地的左上方</p><p>基于地球: 在地球的上半部分中的下方</p><p>基于太阳系: 靠近太阳中心的第三颗星球</p><p>基于不同大小的空间，物体的位置会不断的发生变化，这就需要进行坐标变换.</p><p>这基于小物体在大空间中放置位置的不同，会在大空间中对小物体位置描述产生不同的结果，最后要得到一个确定的位置，顶点着色器可以进行这种不同空间位置的变换，达到你想要的效果。</p><p>形状装配</p><p>将上一步传入的顶点进行连线装配成具有形状的图元</p><p>我们想象在纸上画了几个点，那么我们现在再想象用笔在这几个点之间画线连起来，就是形状装配</p><p>几何着色器</p><p>在生成的图元形状范围内生成新顶点，并将新生成的顶点与图元进行组合生成新形状</p><p>上一个步骤中，我们画了线在点之间连成形状，如果我们突然想加多个三角形，我们可以在原原的某三条线段每条上画一个点，然后再将三个点连起来，新的点和线所组成的新形状是这个阶段来生成的.</p><p>光栅化</p><p>在刚刚生成的形状图元区域内生成对应于屏幕显示的像素填充，然后将屏幕不显示的区域中的物体部分裁剪掉</p><p>片段着色器</p><p>在刚刚形状内部填充的像素中，计算每个像素最终显示的颜色，这个每个像素的颜色最后是基于物体本来的颜色+不同光源照射影响混合计算最后生成的颜色。</p><h6 id="测试和混合">测试和混合</h6><p>最后这个阶段会进行物体之间的深度测试（即物体之间谁在前面和后面，遮挡与被遮挡），以及Alpha透明度测试并进行混合，最后输出的不一样的颜色透明度等其他测试。</p><p>Vertex Array Object - VAO 顶点数组对象</p><p>该顶点数组可用来保存VB0对象，即创建一次添加到数组中，即可保持对刚刚创建的VBO对象进行引用，不用每次需要时重复很多步骤来重新创建。</p><p>需要设置顶点属性配置，即指针指向起始位置，索引间隔</p><p>有几种保存方式，分为一对一，一对多</p><p>VAO[VBO1,VBO2,…]</p><p>VAO[VBO]</p><p>Vertex Buffer Object - VBO 顶点缓冲对象</p><p>在GPU内存（显存）中管理保存顶点数据的对象，把顶点数据保存到显存中通过VBO来管理读取，比经过CPU-&gt;Memory-&gt;GPU的读取效率速度要快很多，几乎能立即访问到数据.</p><p>Element Buffer Object - EBO OR Index Buffer Object - IBO 索引缓冲对象</p><p>在绘制形状时，很多情况下不同形状的顶点位置同一个是重复的，如果使用EBO来进行指定索引，那么我们只需要在数组中保存一份顶点数据就行。如果不使用EBO，程序会按我们定义好的的指针起始位置和数据间隔来读取数据，那么每个形状要单独保存一份顶点数据，会重复很多相同的顶点数据，这样会占用更多的显存.</p><p>Normalized Device Corrdinates - NDC</p><p>标准化设备坐标是指，在一个 X[-1,1] Y[-1,1] Z[-1,1]之间的一个坐标系空间范围中，我们输入的顶点数据会被转化成这个坐标系中相应的位置，如果在这个范围之外的数据，就会被抛弃掉，不被用在后面的屏幕空间中。</p><p>这里有对NDC的深入讨论，这块知识深入理解会在后面补充</p><p>Shader 着色器</p><p>着色器内部就是进行编写图像处理代码的地方</p><p>in、out关键字表示数据的输入、输出</p><p>数据结构：int、float、double、uint和bool</p><p>Uniform 着色器全局变量，可以被着色器程序(Shdaer Program)任意访问和改变变量值</p><p>Texture 纹理</p><p>纹理即我们真实世界上区别不同物体的一个外在表现，人的皮肤、钢铁的铁锈、木头的木纹、毛衣、牛仔裤的不同，这些物体的表面理解为每个物体的纹理.</p><p>纹理坐标: X[0,1] Y[0,1] 即[0,0] - [1,1]这个矩形范围内的坐标用来放置一个纹理，超出这个范围有几种方式来表现超出这个范围外的纹理.</p><p>两个关于材质制作在动画与游戏渲染中的使用和创作的资料，一位在顽皮狗和迪士尼工作过的大神级人物的：</p><p>访谈</p><p>公开演讲</p><p>Transformations 变换 线性代数知识</p><p>“direction(方向)” + “magnitude(大小)” = Vectors(向量)</p><p>向量是具有 “方向” 和 “大小” 的变量 形象的想象 从一个点 指向 另一个点 的一个箭头</p><p>数学中 v = {x, y, z} 用来表示一个3D空间中的向量</p><p>默认,向量是从原点{0, 0, 0}指向空间中的任意一个点, {x, y, z}则是所指向的点</p><p>Scalar is a single number, 标量是一个数字 可以当作是向量中的一个分量</p><p>向量与标量的运算:{x, y, z} + Scalar =</p><p>{ x + Scalar = new X,</p><p>y + Scalar = new Y,</p><p>z + Scalar = new Z }</p><p>向量有 加、减、乘运算和取反</p><p>取反 -&gt; 向量取当前方向的相反</p><p>-{x, y, z} = {-x, -y, -z}</p><p>加、减 -&gt; 两个向量的x，y, z分别加减:</p><p>{x1, y1, z1} + {x2, y2, z2} =</p><p>{ x1 + x2 = new X,</p><p>y1 + y2 = new Y,</p><p>z1 + z2 = new Z }</p><p>长度 -&gt; 如何得到向量的长度:</p><p>高中学过的勾股定理(Pythagoras Theorem)来获取长度(length)</p><p>取向量{x, y, z}中的x, y</p><div class="table-wrapper"><table><tbody><tr><td> <td>v<td> <td>表示向量长度, 就等于 开根号下 的 x平方 + y平方</table></div><p>垂直三角形的两直角边相加开平方根等于第三边斜边的长度 就取的了向量的长度</p><p>(博客渲染引擎无法渲染出数学公式= =!，只好先文字描述，虽然看文字很难理解，无法直观的理解，解决博客框架的渲染引擎后加上直观的数学公式)</p><p>乘 -&gt; 点乘(Dot Product)、叉乘(Cross Product)为什么不是普通的相乘，因为普通的乘法在向量上是没有定义的，因为它在视觉上是没有意义的</p><p>点乘:</p><p>两向量的数乘结果再乘与两向量间夹角的余弦值</p><div class="table-wrapper"><table><tbody><tr><td>v⋅k =<td> <td>v<td> <td>⋅<td> <td>k<td> <td>⋅cosθ</table></div><p>那么点乘的意义在哪？让v和k向量取单位向量即为1那么</p><p>v⋅k = 1⋅1⋅cosθ = cosθ</p><p>v⋅k = cosθ</p><div class="table-wrapper"><table><tbody><tr><td>两向量相乘为cosθ, 因为cos0 = 1<td>cos90 = 0, 那么就可以判断两向量是平行还是垂直</table></div><p>因为一些情况下，我们并不在意两向量的长度，而关注的是他们的方向，从而可以计算得出余弦值，再获得向量夹角，在计算光照时，有重要作用.</p><p>叉乘:</p><p>两个不平行向量作为输入，生成一个正交于两个输入向量的第三个向量</p><p>叉乘的作用即为获得一条正交于另外两个向量的新向量</p><p>矩阵</p><p>最重要的一个知识点到了，前面关于向量的知识点都是为这里做铺垫的.</p><p>那么矩阵的作用是用来干嘛的呢，就是用来变换向量的。可以将一个向量进行缩放、位移、旋转，以及如果同时进行前面这三个变换可以将前面三个组合。</p><p>那么就有变换矩阵、位移矩阵、旋转矩阵，以及组合三个变换的组合矩阵，最终得到一个你所需要的矩阵，再用向量与矩阵相乘，即可得到新向量。</p><p>一个知识点，矩阵相乘的顺序很重要，因为矩阵乘法不遵守交换律，先旋转再位移和先位移再旋转是不一样的结果的。</p><p>矩阵相乘顺序是从右往左，如果要先缩放，再位移，那么缩放矩阵要在最右手边再往左才是位移矩阵。</p><p>矩阵的加减乘的数学实现可以在这里阅读，这里就不再重新复述一次，写好多字很累呀！</p><p>而上面的这些数学公式及运算在GLM这个数学库中已经被实现，我们只需要使用这个库来进行运算即可.</p><p>Coordinate Systems 坐标系统</p><p>Local Space -&gt; World Space -&gt; ViewSpace -&gt; Clip Space -&gt; Screen Space</p><p>几个重要的坐标变换矩阵</p><div class="table-wrapper"><table><tbody><tr><td>Model Matrix<td>View Matrix<td>Projection Matrix</table></div><p>那么整个流程:</p><p>Local Space -&gt; [Model Matrix] -&gt; World Space -&gt; [View Matrix] -&gt; View Space -&gt; [Projection Matrix] -&gt; Clip Space -&gt; [ViewPort TransForm] -&gt; Screen Space</p><p>在View Space -&gt; [Projection Matrix] -&gt; Clip Space 这个阶段中</p><p>Projection Martix有两种矩阵Orthographic Projection Matrix和Perspective Projection Matrix</p><p>即正射和透视两种矩阵，区别在于透视具有近大远小的处理，而正射则没有</p><p>一个顶点坐标经过 模型矩阵、观察矩阵和投影矩阵，最后就变换乘裁剪空间中的坐标</p><p>Vclip = Mprojection ⋅ Mview ⋅ Mmodel ⋅ Vlocal</p><p>光照和颜色</p><p>现实世界中的物体所呈现出来的外观颜色是 物体本身所固有的颜色 + 光照 = 混合后反射至我们眼睛所看到的颜色</p><p>因此，在OpenGL中，我们需要对物体颜色及所有能对物体进行照射的光源 进行光照数值计算 从而得到最后真实的颜色</p><p>Ambient Lighting 环境光照</p><p>在极端情况如凌晨，此时周围的亮度时最暗的时候，最暗时我们依然能隐约看到物体外轮廓，月光等一些微弱环境光源能提供最基础的光，让我们能看清楚周围的环境，这些光称为环境光照。</p><p>Diffuse Lighting 漫反射光照</p><p>物体表面粗糙程度不同都会反射各个角度照射在其上面的光，我们从各个角度会看到差不多的颜色，我们称这个为漫反射光，漫反射光能表现出这个物体表面的材质特征</p><p>Specular Lighting 镜面光照</p><p>物体的高光部分，我们视线投射在物体上，总有一小块区域的亮度时明显高于其他区域的，因此这块区域的颜色及亮度我们基于镜面光照来计算</p><p>法向量</p><p>法向量是一个垂直于顶点向量表面的单位向量，我们可以通过计算照射在物体表面的光线与法向量的夹角，从而计算出漫反射的最终颜色的反射系数大小</p><p>法向量变换到模型空间时，物体的缩放、位移、旋转都会影响到法向量，因为法向量仅代表一个方向，并没位置信息，不等比例缩放也会让法向量不垂直于片段表面，从而让光照计算无法得到正确结果。</p><p>因此，在转换过程中我们要使用专门的 Normal Matrix 法线矩阵 [模型矩阵左上角的逆矩阵的转置矩阵] 来进行变换，从而保证得到正确的法向量。</p><h6 id="materials-材质">Materials 材质</h6><p>材质用来表现世界中各种各样的物体，钢、陶瓷、木头对光的反射和他们纹理都是不同，所以需要材质来表现出每个物体的光线和纹理特征</p><p>上面提到的光照的内容中：环境光、漫反射、镜面光都是构成一个材质的一部分，因此一个材质有这么些内容构成</p><p>环境光、漫反射、镜面光、反光度系数、纹理</p><p>最后输出 result = ambient + diffuse + specular</p><h6 id="光源">光源</h6><p>光源有以下几种:</p><p>平行光 - 太阳光</p><p>光线近似平行，并来自同一个方向</p><p>点光源 - 路灯、灯泡、火</p><p>光线向光源360度方向发射，随距离增加而亮度逐渐衰减至0</p><p>衰减公式</p><p>Fatt = 1.0 / Kc + Kl d + Kq d^2</p><p>Kc 常数项保持1，保证分母永远不比1小，随距离增加亮度不会变亮</p><p>Kl d 一次向乘于距离，让亮度呈线性衰减</p><p>Kq d^2 二次想乘于距离的平方，让亮度随距离呈指数衰减</p><p>聚光 - 手电筒</p><p>向一个方向一定半径内发射，也是随距离亮度逐渐衰减至0</p><p>通过 聚光灯的 Position 位置向量 与 片段位置向量 FragPosition 计算得到 光线距离（灯到物体可见的任意位置） LightDir</p><p>然后用聚光灯的方向向量LightDirection与光线距离LightDir点乘得到两者间的夹角，从而用得到的夹角判断是否在聚光灯的照射角度范围内，从而做出物体表面片段的光照计算</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/haifuyun.github.io/categories/graphics/'>Graphics</a>, <a href='/haifuyun.github.io/categories/opengl/'>OpenGL</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/haifuyun.github.io/tags/graphics/" class="post-tag no-text-decoration" >Graphics</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=LearnOpenGL - Hi!FuYun&url=https://hifuyun.com/haifuyun.github.io/posts/LearnOpenGL/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=LearnOpenGL - Hi!FuYun&u=https://hifuyun.com/haifuyun.github.io/posts/LearnOpenGL/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=LearnOpenGL - Hi!FuYun&url=https://hifuyun.com/haifuyun.github.io/posts/LearnOpenGL/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/haifuyun.github.io/posts/Computer-Graphics-Visibility/">Computer Graphics Visibility</a><li><a href="/haifuyun.github.io/posts/Computer-Graphics-Shading/">Computer Graphics Shading</a><li><a href="/haifuyun.github.io/posts/Computer-Graphics-ShadingTexture/">Computer Graphics Shading Texture</a><li><a href="/haifuyun.github.io/posts/Computer-Graphics-Transformation/">Computer Graphics Transformation</a><li><a href="/haifuyun.github.io/posts/Computer-Graphics-Viewing-transformation/">Computer Graphics Viewing transformation</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/haifuyun.github.io/tags/graphics/">Graphics</a> <a class="post-tag" href="/haifuyun.github.io/tags/data-struct/">Data Struct</a> <a class="post-tag" href="/haifuyun.github.io/tags/ios/">iOS</a> <a class="post-tag" href="/haifuyun.github.io/tags/python/">Python</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/haifuyun.github.io/posts/Computer-Graphics-Transformation/"><div class="card-body"> <span class="timeago small" > Jun 17 <i class="unloaded">2021-06-17T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Computer Graphics Transformation</h3><div class="text-muted small"><p> 资料来源：https://sites.cs.ucsb.edu/~lingqi/teaching/games101.html 笛卡尔坐标系中，空间坐标的位置变换是通过矩阵相乘实现的. Linear Transforms = Matrices \[\left [ \begin{matrix} x^{new} \\ y^{new} \end{matrix} \right ] = \l...</p></div></div></a></div><div class="card"> <a href="/haifuyun.github.io/posts/Computer-Graphics-Viewing-transformation/"><div class="card-body"> <span class="timeago small" > Jun 18 <i class="unloaded">2021-06-18T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Computer Graphics Viewing transformation</h3><div class="text-muted small"><p> 资料来源：https://sites.cs.ucsb.edu/~lingqi/teaching/games101.html View / Camera Transformation 如何呈现一个画面？ Define the camera first 首先定义一个摄像机 Position (位置) \(\vec e\) Look-at / ga...</p></div></div></a></div><div class="card"> <a href="/haifuyun.github.io/posts/Computer-Graphics-Screen/"><div class="card-body"> <span class="timeago small" > Jun 19 <i class="unloaded">2021-06-19T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Computer Graphic Screen</h3><div class="text-muted small"><p> 资料来源：https://sites.cs.ucsb.edu/~lingqi/teaching/games101.html What’s after MVP? Model transformation (placing objects) View transformation (placing camera) View transformation (placing camera...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/haifuyun.github.io/posts/Python-%E8%AF%AD%E6%B3%95/" class="btn btn-outline-primary" prompt="Older"><p>Python 语法</p></a> <a href="/haifuyun.github.io/posts/Unity-shader-and-Compoent/" class="btn btn-outline-primary" prompt="Newer"><p>Unity shader and Compoent</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/haifuyun">haifuyun</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/haifuyun.github.io/tags/graphics/">Graphics</a> <a class="post-tag" href="/haifuyun.github.io/tags/data-struct/">Data Struct</a> <a class="post-tag" href="/haifuyun.github.io/tags/ios/">iOS</a> <a class="post-tag" href="/haifuyun.github.io/tags/python/">Python</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/haifuyun.github.io/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hifuyun.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
